# FoodCraftClub Marketplace

Онлайн-маркетплейс, где пользователи могут покупать продукты от различных продавцов.

## Технологический стек

### Backend
- **NestJS** - основной фреймворк
- **Prisma ORM** - для работы с базой данных
- **MySQL** - база данных

### Frontend
- **Next.js** - фреймворк для фронтенда
- **shadcn/ui** - библиотека UI-компонентов
- **TailwindCSS** - для стилизации
- **@heroicons/react** - иконки

### Внешние сервисы
- **Clerk.dev** - аутентификация пользователей
- **Stripe Billing** - подписки и платежи
- **Directus** - headless CMS для управления контентом
- **PostHog** - аналитика и отслеживание событий

## Структура проекта

```
├── backend/                # NestJS бэкенд
│   ├── prisma/            # Prisma схема и миграции
│   ├── src/               # Исходный код
│   │   ├── modules/       # Модули приложения
│   │   │   ├── clerk/     # Интеграция с Clerk.dev
│   │   │   ├── directus/  # Интеграция с Directus
│   │   │   ├── logger/    # Логирование
│   │   │   ├── orders/    # Управление заказами
│   │   │   ├── prisma/    # Prisma сервис
│   │   │   ├── products/  # Управление продуктами
│   │   │   └── stripe/    # Интеграция со Stripe
│   │   ├── interceptors/  # Интерцепторы
│   │   ├── filters/       # Фильтры исключений
│   │   └── middleware/    # Middleware
│   ├── .env               # Переменные окружения
│   └── package.json       # Зависимости
└── frontend/              # Next.js фронтенд
    ├── src/               # Исходный код
    │   ├── app/           # Страницы приложения
    │   ├── components/    # UI компоненты
    │   ├── lib/           # Утилиты и API клиенты
    │   └── providers/     # Провайдеры контекста
    ├── public/            # Статические файлы
    ├── .env.local         # Переменные окружения
    └── package.json       # Зависимости
```

## Установка и запуск

### Предварительные требования
- Node.js (v18+)
- MySQL
- Clerk.dev аккаунт
- Stripe аккаунт
- Directus (установленный локально или облачный)
- PostHog аккаунт

### Backend

1. Установите зависимости:
```bash
cd backend
npm install
```

2. Настройте переменные окружения:
```bash
cp .env.example .env
# Отредактируйте .env файл с вашими настройками
```

3. Сгенерируйте Prisma клиент:
```bash
npx prisma generate
```

4. Запустите миграции базы данных:
```bash
npx prisma migrate dev
```

5. Запустите сервер:
```bash
npm run start:dev
```

### Frontend

1. Установите зависимости:
```bash
cd frontend
npm install
```

2. Настройте переменные окружения:
```bash
cp .env.example .env.local
# Отредактируйте .env.local файл с вашими настройками
```

3. Запустите сервер разработки:
```bash
npm run dev
```

## Основные функции

- **Аутентификация пользователей** через Clerk.dev
- **Управление продуктами** через Directus CMS
- **Оформление заказов** с интеграцией Stripe для платежей
- **VIP-подписки** для покупателей и продавцов через Stripe Billing
- **Система баллов** для лояльности клиентов
- **Аналитика** через PostHog для отслеживания пользовательских событий

## Интеграция с внешними сервисами

### Clerk.dev
- Используются готовые UI-компоненты для входа, регистрации и управления профилем
- Синхронизация пользователей между Clerk и нашей базой данных через вебхуки

### Directus
- Все CRUD-операции с товарами, заказами и пользователями выполняются через Directus
- Синхронизация данных между Directus и нашей базой данных через API и вебхуки

### Stripe
- Обработка платежей за заказы
- Управление подписками для VIP-пользователей и продавцов

### PostHog
- Отслеживание пользовательских событий (просмотр товаров, добавление в корзину, оформление заказа)
- Анализ пользовательского поведения для улучшения UX

## API Endpoints

### Webhook Endpoints
- `POST /webhooks/clerk` - Обработка вебхуков от Clerk.dev
- `POST /webhooks/stripe` - Обработка вебхуков от Stripe
- `POST /webhooks/directus` - Обработка вебхуков от Directus

### Products API
- `GET /products` - Получение списка товаров
- `GET /products/:id` - Получение информации о товаре
- `GET /products/categories` - Получение списка категорий

### Orders API
- `GET /orders` - Получение списка заказов пользователя
- `POST /orders` - Создание нового заказа
- `GET /orders/:id` - Получение информации о заказе

### Cart API
- `GET /cart/items` - Получение содержимого корзины
- `POST /cart/items` - Добавление товара в корзину
- `PATCH /cart/items/:id` - Обновление количества товара в корзине
- `DELETE /cart/items/:id` - Удаление товара из корзины
